# 1. Цель проекта
Цель проекта — разработать систему для взаимодействия специалистов рекламного агентства с клиентами. В системе должна быть возможность у администраторов создавать задачи с дедлайном 
и назначать в качестве исполнителя сотрудника, с возможностью отслеживать выполнение, чат для общения с клиентом с возможностью отправлять файлы и изображения
Предусмотрена интеграция с Telegram для удобной связи и доставки уведомлений.

# 2. Описание системы
Система состоит из следующих функциональных блоков:
1. Регистрация, аутентификация и авторизация;
2. Панель управления и аналитики для администратора;
3. Управление профилями сотрудников;
4. Управление проектами клиентов;
5. Функционал создания и отслеживания задач;
6. Функционал для сотрудников;
7. Функционал для клиентов;
8. Чат между клиентом и сотрудником агенства с возможностью отправки файлов;
9. Функционал интеграции с Телеграм;
10. Рассылка информационных уведомлений.

## 2.1 Типы пользователей
В системе предусмотрены три уровня пользователей:
- администратор управляет учетными записями, проектами и задачами; 
- сотрудник работает с клиентами в рамках назначенных задач с ограниченным доступом к данным;
- клиент запускает проекты, общается через чат, получает уведомления, доступ к документам и может редактировать данные своего проекта;
- нет — выдается после регистрации.

## 2.2 Регистрация / Аутентификация
Аутентификация, как и регистрация, происходит без пароля — через электронную почту. Система отправляет на указанный адрес ссылку, по которой пользователь может перейти и авторизоваться в системе.

Процесс добавления администраторов в первой версии системы может быть реализован через форму регистрации пользователя, принимающую:
- имя, фамилию — обязательное поле;
- email — обязательное поле.

Этот способ действует только до добавления первого пользователя — он автоматически становится администратором.
В дальнейшем назначение ролей будет осуществляться через панель управления уже существующими администраторами.

Учетные записи сотрудников могут быть зарегистрированы самостоятельно, как обычные пользователи, либо добавлены через панель управления одним из администраторов.
Если сотрудник создал аккаунт самостоятельно, администратору необходимо найти его в панели управления и назначить соответствующую роль.

Тип учетной записи клиент выдается после подписания договора администратором вручную через управление учетными записями.

## 2.3 Панель управления — Администратор

### 2.3.1 Управление учетными записями
Панель управления должна иметь функционал управления учетными записями пользователей системы. Должна быть возможность просматривать и фильтровать учетные записи по имени, почте, типу учетной записи и дате регистрации; редактировать данные, добавлять, блокировать и удалять учетные записи. Также должна быть возможность управлять типом учетной записи (администратор, сотрудник, клиент, нет).

### 2.3.2 Управление проектами клиентов
Необходим функционал управления проектами клиентов. Должна быть возможность просмотра проектов, поиска по названию проекта и имени клиента, фильтрации по дате создания и типу проекта.

Проекты отображаются серыми — до подписания договора, и синими — с момента начала работы (после подписания договора). Сортировка должна предусматривать отображение активных проектов выше неактивных.

Администратор должен иметь возможность:
- изменять данные проекта;
- изменять его статус (активный/неактивный);
- просматривать контактные данные клиента;
- писать сообщения в чат с клиентом;
- прикреплять файлы и изображения;
- отправлять клиенту уведомления.

### 2.3.3 Управление задачами
Необходим функционал системы задач. Администратор должен иметь возможность:
- создавать задачи;
- прикреплять к задаче доступные материалы (один или несколько проектов с возможностью настройки доступа для сотрудника);
- назначать сотрудника исполнителем (с предоставлением доступа к связанным с задачей данным);
- устанавливать дедлайн;
- отслеживать выполнение задачи.

К задаче могут быть привязаны:
- файлы;
- изображения;
- текстовое описание в формате Markdown;
- проекты клиентов.

При добавлении проекта клиента в качестве зависимости должна быть возможность настроить следующие уровни доступа:

- доступ к основной информации о проекте (содержимое брифа);
- контактные данные клиента;
- доступ к просмотру истории чата (без этого сотрудник не увидит старые сообщения, но будет видеть новые — с момента назначения задачи до её выполнения);
- доступ к чату (возможность писать сообщения).

### 2.3.4 Добавление / Изменение кейсов (опционально)
Должна быть возможность:
- добавлять кейсы;
- задавать им имя;
- указывать сферу деятельности клиента — для удобной отправки кейсов через чат.

Нужна отдельная кнопка для отправки кейсов с возможностью:
- выбора кейсов;
- фильтрации по имени, дате, сфере деятельности.

Кейсы доступны только авторизованным клиентам, которым был предоставлен доступ к их просмотру (доступ выдается при отправке кейсов).

### 2.3.5 Редактор постов
Должна быть возможность:
- добавлять и изменять посты;
- публиковать их;
- задавать название, описание, обложку.

Посты открываются на отдельной странице. Содержимое задается во встроенном редакторе на основе Markdown. Постами можно делиться и оценивать их лайками.

### 2.3.6 Управление лендингом (опционально)
Нужна возможность:
- изменять изображения и тексты лендинга;
- включать и отключать блоки;
- менять их местами (опционально);
- настраивать SEO.

### 2.3.7 Аналитика и сбор данных
Необходима страница, на которой администратор сможет просматривать общую информацию о работе системы в виде графиков и схем.

## 2.4 Панель управления — Сотрудник
Сотрудник должен иметь возможность:

- редактировать свой профиль;
- просматривать текущие задачи;
- просматривать доступные проекты;
- брать задачу в работу (если назначено более одной задачи — сотрудник может выполнять их по очереди или приостанавливать выполнение одной и начать другую).

> ⚠️ Это ограничение связано с возможной путаницей в доступах: каждая задача предоставляет доступ к определённым проектам и документам, и скрещивание этих доступов может привести к нарушению структуры безопасности и конфиденциальности.

При активной задаче сотрудник получает доступ только к тем данным, которые указаны в её настройках: проектам, документам, контактам, чатам и другим материалам.


## 2.5 Функционал для клиента

Клиент должен иметь возможность:

- добавлять проекты, задавая имя и другую информацию, необходимую для формирования технического задания;
- редактировать информацию о проекте в любое время.

Каждый проект отображается в отдельном окне, содержащим:

- чат с сотрудниками;
- документы, связанные с проектом;
- чеки об оплате;
- информацию о самом проекте.

Клиент может получать системные уведомления. Должна быть возможность привязать мессенджер **Telegram** для получения:

- сообщений от сотрудников;
- уведомлений от системы напрямую в чат.

Клиент также видит текущий статус каждого проекта.

- **активен** — договор заключен;
- **заморожен** — временно приостановлен;
- **неактивен** — договор еще не заключен.

## 2.6 Чат между клиентом и сотрудником агентства
Чат предназначен для коммуникации между клиентом и назначенными сотрудниками агентства в рамках конкретного проекта. Система должна обеспечивать стабильную и безопасную передачу сообщений и файлов, хранение истории переписки и привязку сообщений к проекту.

#### 2.6.1 Структура чата
- Чат привязан к конкретному проекту;
- Каждый проект имеет **отдельную ленту чата**;
- Сообщения отображаются в хронологическом порядке, с указанием автора сообщения, времени отправки, статуса (отправлено, доставлено, прочитано).

#### 2.6.2 Возможности клиента и сотрудника
- отправлять и получать текстовые сообщения;
- прикреплять файлы и изображения (PDF, DOCX, PNG, JPG и др.);
- просматривать загруженные файлы в списке вложений чата;
- скачивать файлы;
- просматривать дату и автора отправленного файла;
- получать уведомления о новых сообщениях (веб + Telegram при привязке);
- видеть статус прочтения (например, двойная галочка как в мессенджерах);
- поиск по сообщениям и вложениям.

#### 2.6.3 Дополнительные возможности сотрудника
- просматривать внутренние служебные заметки, недоступные клиенту (*опционально*);
- прикреплять шаблонные ответы или документы (например, договор, счёт);
- отмечать сообщения как важные или требующие ответа;
- внутренние заметки и обсуждения (доступные только сотрудникам).

#### 2.6.4 Отправка файлов
- Максимальный размер файла — **20 МБ** (можно настроить).
- Поддержка drag-and-drop, а также загрузки через кнопку "Прикрепить файл".
- Файлы хранятся в облаке и доступны в рамках проекта.
- Возможность предпросмотра изображений и некоторых документов (PDF, изображения).
- Система должна проверять файлы на вирусы (интеграция с антивирусным API — *опционально*).

#### 2.6.5 Уведомления
- Уведомление о новом сообщении отображается в панели уведомлений (веб-интерфейс).
- При наличии привязки Telegram — пересылка сообщений (или уведомлений о них) в чат с ботом.
- В Telegram должно быть указано: от кого сообщение, краткое содержимое, ссылка на проект/чат в системе.

#### 2.6.6 Требования к интерфейсу
- Простая и удобная лента сообщений, похожая на мессенджер.
- Индикация загрузки файлов, статуса доставки/прочтения, ошибок при отправке.
- Интерфейс должен работать на мобильных и десктопных устройствах.

# 3. Предлагаемый стек технологий
Бэкенд:
- Язык TypeScript
- Фреймворк NestJS
- БД PostgreSQL
- Сессии Redis
- ORM Prisma
- Миграции бд Prisma
- Интеграция с телеграм node-telegram-bot-api

Фронтенд:
- Язык TypeScript
- Сборщик Vite
- Стили TailwindCSS v4
- React
- Запросы Tanstack Query
- UI Kit на основе shadcn/ui

Хранение файлов и изображений должно осуществлятся в s3 совместимом хранилище.

# 4. Требование к дизайну
Минимализм, лаконичность, акцент на содержание. Основной фоновый цвет белый.
Должен присутствовать логотип Системы. В нижней части системы (в подвале) должна быть ссылка на разработчика,
в часности на сайт WhiteShard: white-shard.ru
